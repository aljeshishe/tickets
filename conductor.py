import json

import requests
import aviasales

headers={
'x-gateway-servedby': 'gw51.skyscanner.net',
'x-skyscanner-channelid': 'website',
# 'accept': 'application/json, text/javascript, */*; q=0.01',
# 'accept-encoding': 'gzip, deflate, br',
# 'accept-language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
# 'content-type': 'application/json; charset=utf-8',
# 'cookie': 'traveller_context=52ca03c6-63a2-4d51-a625-a73cb2a082e9; abgroup=72986736; ssculture=locale:::ru-RU&market:::RU&currency:::RUB; firstvisit=overlay:::show; preferences=3d368559a26f40b287e8fbf82ba038de; ver=28; _ga=GA1.2.2035660979.1529763780; _gid=GA1.2.1175734101.1529763780; __gads=ID=2d38246fa1e732a7:T=1529763791:S=ALNI_MZH2nPIfHx0cDHM6qjUNxIqK40jJA; cto_lwid=aeb7d9d6-f965-4859-bfdf-a0c334b1a1c0; _ym_uid=1529763786475681610; _ym_d=1529763786; _pxvid=f811b9e0-76f0-11e8-908c-c9492bd5a489; akaas_flights-home=1532436812~rv=60~id=ffe27f217845453b265b0d9a08045e96; ASP.NET_SessionId=6ezwhfqtm; settings=acql:::true; acq=64b85aed-65c4-4548-ad7f-d3e0eab4b41e|b0536e32-4d85-414f-b310-7a1c3ec3dd64; _ym_isad=2; ssab=AAExperiment_V8:::a&AD_CPM_Urgency_Metric_Experiment_V2:::b&AEP_SEOPageUniversalLinksExperiment_TR_V3:::on&AFS_DayView_Firebase_NPS_V10:::off&ATBT_Spring_Clean_Carhire_Search_Controls_V17:::b&Ads_UseESIAds_V1:::b&Car_AATest_V4:::a&CountriesFooterLinkValues_AddcountryforBRmarket_07_07_2016_55_49_V1:::b&DEAL_Default_To_Two_Guests_V3:::b&FLUX787_QuoteBlacklist_V2:::a&FLUX_GDT2791_SendPriceTraceToMixpanel_V6:::b&FlightsAndroidProdTest_V1:::b&FlightsHeroStraplineLower_PRE_PRODHeroimagechangefortheUSmarket_03_05_2016_00_40_V1:::a&FlightsiOSProdTest_V2:::b&Fss_NewSearchControls_V6:::c&Fss_springclean_datepicker_V5:::b&GDT3332_UseAWSBrowseServiceEndPointOnShelves_V14:::b&HNT_Android_TID_Exponential_Backoff_V5:::on&Hfe_OfficialPartner_It2_V2:::b&Hfe_PricePerNight_V2:::b&Hotel_Sorting_Impact_Factors_V7:::b&Hsc_ChildrenAgeView_V10:::b&Hsc_MexicanToAS2_V4:::b&Mexico_Etnio_Interview_Screener_01_V1:::b&OTR_ImageShare_UseDeepLinkGenerator_V9:::on&STARK_iOS_UseWalletAssetServiceForLoyaltyCards_V7:::on&TCS_Send_Searching_Email_V4:::b&Trex_OCFlexSuggestions_V23:::a&Trex_OCSearchControls_V41:::b&Trex_OCSearchControls_DayView_V9:::b&TripsTopicPage_Hidethetopicpage_27_02_2018_34_33_V1:::b&UseSkippyLogging_V3:::b&UtidTravellerIdentity_V11:::b&VES_Android_CountryEverywhereFeed_V12:::on&WPT_React16_upgrade_V2:::a&WPT_SkipRequestAshx_V2:::a&Web_Migration_flights_day_view_V7:::b&Web_Migration_home_V10:::b&Web_Migration_month_view_V12:::b&appinsp_VES_USE_BROWSE_PROXY_V4:::on&branch_banner_oc_version_V28:::new&dbook_cath_trafficcontrol_all_web_V2:::a&dbook_drag_trafficcontrol_all_web_V2:::a&dbook_flot_trafficcontrol_ru_web_V2:::a&dbook_sune_trafficcontrol_web_V3:::a&dbook_tkru_trafficcontrol_ru_web_V2:::a&fbw_transliterate_names_V1:::a&fps_lus_client_quote_service_split_traffic_V225:::b&fps_lus_qes_split_traffic_V22:::a&fps_lus_qss_automatic_rules_V19:::a&fps_lus_send_quotes_to_slipstream_V25:::noexperiment&fps_mbmd_V11:::b&fps_quoteretrieval_aws_V115:::aws&fps_route_summary_traffic_shift_V6:::b&fss_Thor_TrafficTest_V30:::b&glu_springCleanRollout_V2:::a&rts_magpie_soow_data_collection_V5:::budget&rts_wta_shadowtraffic_V367:::b&scaffold_wireup_dont_delete_V1:::b; akaas_month-view=1532448544~rv=37~id=ccb7afd99626ae7b7b1c0e788f1f7b5e; akaas_skippy_aws_migration=1532458304~rv=39~id=1bb984adcf58bae2df7fd1e28158bca7; X-Mapping-rrsqbjcb=xsfzfc7gj3fhyzj1idgotbviqx2wmz9j; _gat_uatracker=1; _gat=1; akaas_flights_day_view=1532469735~rv=31~id=213b8028ee82033fd3252adbf9042abb; scanner=currency:::RUB&adultsV2:::1&childrenV2&from:::LED&to:::BTS&fromCy:::RU&toCy:::SK&legs:::LED|2018-10-20|BTS&oym:::1810&oday:::20&wy:::0&tripType:::one-way&cabinclass:::Economy&preferDirects&iym:::1810&iday:::20; mp_2434748954c30ccc5017faa456fa3d38_mixpanel=%7B%22distinct_id%22%3A%20%221642d06d5ef63c-09d427d092baf9-5b183a13-1fa400-1642d06d5f0901%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%2C%22User%20Locale%22%3A%20%22RU-RU%22%2C%22User%20Market%22%3A%20%22RU%22%2C%22User%20Currency%22%3A%20%22RUB%22%2C%22New%20User%22%3A%20false%2C%22Internal%20User%22%3A%20%22%22%2C%22Mobile%22%3A%20%22FALSE%22%2C%22Tablet%22%3A%20%22FALSE%22%2C%22OS%20Version%22%3A%20%22NT%206.1%22%2C%22Device%20Model%22%3A%20%22CHROME%20-%20WINDOWS%22%2C%22Browser%20Version%22%3A%20%2267.0.3396.87%22%2C%22Microsite%22%3A%20%22SOL%22%2C%22Cookie%20Policy%20Alert%20Acknowledged%22%3A%20false%7D; sspref=authcheckedexpiry:::1529877918058; RT="sl=4&ss=1529876892118&tt=17391&obo=0&bcn=%2F%2F2e33b7d3.akstat.io%2F&sh=1529877737445%3D4%3A0%3A17391%2C1529877582192%3D3%3A0%3A15364%2C1529877443470%3D2%3A0%3A7435%2C1529877120584%3D1%3A0%3A937&dm=skyscanner.ru&si=835bea88-7147-457a-b328-043a8cc56aeb"; _pxff_tm=1; _px3=31f010e064a7a1838be98cec70567279ae1e33e8cb3be9f6a6d627ad6b8b1290:FHSzVIrzYGVkXZI52TA75nG6iH9w7q97+N2WtTX3iJbbxg842XJCplFC7yrx7wVM8vPGhxAKiakCMQ+1sOmmrw==:1000:XjXSBBTTLekPvfBtPEMTPAUami/Yk1iBGGu4f/3/mhT3ijcod68LSY/B2gKcowE+k1lskudHl9xS8cjceKDfBNsYoh2AsF8QPr6rIhXx2YA5rvfnzcfWd4o4Ui9eM9zAn/w8sF4MMrIwLDeNyqPrxh7cQWXu6li+YUFduzck29Y=',
# 'referer': 'https://www.skyscanner.ru/transport/flights/led/bts/181020/?adults=1&children=0&adultsv2=1&childrenv2=&infants=0&cabinclass=economy&rtn=0&preferdirects=false&outboundaltsenabled=false&inboundaltsenabled=false&ref=home',
# 'skyscanner-utid': '52ca03c6-63a2-4d51-a625-a73cb2a082e9',
# 'user-agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36',
# 'x-distil-ajax': 'azezcavtdrrxfqrtbw',
# 'x-requested-with': 'XMLHttpRequest',
# 'x-skyscanner-devicedetection-ismobile': 'false',
# 'x-skyscanner-devicedetection-istablet': 'false',
# 'x-skyscanner-if-none-match': 'dd010a5a-abbb-4b3e-afaa-6dac2bd8c7c5',
# 'x-skyscanner-mixpanelid': '1642d06d5ef63c-09d427d092baf9-5b183a13-1fa400-1642d06d5f0901',
# 'x-skyscanner-traveller-context': '52ca03c6-63a2-4d51-a625-a73cb2a082e9',
# 'x-skyscanner-viewid': '29dff4a3-e808-45f0-abdd-846842d0c4bb'
#mandatory
# 'x-gateway-servedby': 'gw51.skyscanner.net',
# 'x-skyscanner-channelid': 'website',

# 'accept': 'application/json, text/javascript, */*; q=0.01',
# 'accept-encoding': 'gzip, deflate, br',
# 'accept-language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
# 'content-type': 'application/json; charset=utf-8',
# 'cookie': 'traveller_context=52ca03c6-63a2-4d51-a625-a73cb2a082e9; ssab=AAExperiment_V8:::a&AD_CPM_Urgency_Metric_Experiment_V2:::b&AEP_SEOPageUniversalLinksExperiment_TR_V3:::on&AFS_DayView_Firebase_NPS_V10:::off&ATBT_Spring_Clean_Carhire_Search_Controls_V17:::b&Ads_UseESIAds_V1:::b&Car_AATest_V4:::a&CountriesFooterLinkValues_AddcountryforBRmarket_07_07_2016_55_49_V1:::b&DEAL_Default_To_Two_Guests_V3:::b&FLUX787_QuoteBlacklist_V2:::a&FLUX_GDT2791_SendPriceTraceToMixpanel_V6:::b&FlightsAndroidProdTest_V1:::b&FlightsHeroStraplineLower_PRE_PRODHeroimagechangefortheUSmarket_03_05_2016_00_40_V1:::a&FlightsiOSProdTest_V2:::b&Fss_NewSearchControls_V6:::c&Fss_springclean_datepicker_V5:::b&GDT3332_UseAWSBrowseServiceEndPointOnShelves_V14:::b&HNT_Android_TID_Exponential_Backoff_V5:::on&Hfe_OfficialPartner_It2_V2:::b&Hfe_PricePerNight_V2:::b&Hotel_Sorting_Impact_Factors_V7:::b&Hsc_ChildrenAgeView_V10:::b&Hsc_MexicanToAS2_V4:::b&Mexico_Etnio_Interview_Screener_01_V1:::b&OTR_ImageShare_UseDeepLinkGenerator_V9:::on&STARK_iOS_UseWalletAssetServiceForLoyaltyCards_V7:::on&TCS_Send_Searching_Email_V4:::b&Trex_OCFlexSuggestions_V23:::a&Trex_OCSearchControls_V41:::b&Trex_OCSearchControls_DayView_V9:::b&TripsTopicPage_Hidethetopicpage_27_02_2018_34_33_V1:::b&UseSkippyLogging_V3:::b&UtidTravellerIdentity_V11:::b&VES_Android_CountryEverywhereFeed_V12:::on&WPT_React16_upgrade_V2:::a&WPT_SkipRequestAshx_V2:::a&Web_Migration_flights_day_view_V7:::b&appinsp_VES_USE_BROWSE_PROXY_V4:::on&branch_banner_oc_version_V28:::new&dbook_cath_trafficcontrol_all_web_V2:::a&dbook_drag_trafficcontrol_all_web_V2:::a&dbook_flot_trafficcontrol_ru_web_V2:::a&dbook_sune_trafficcontrol_web_V3:::a&dbook_tkru_trafficcontrol_ru_web_V2:::a&fbw_transliterate_names_V1:::a&fps_lus_client_quote_service_split_traffic_V225:::b&fps_lus_qes_split_traffic_V22:::a&fps_lus_qss_automatic_rules_V19:::a&fps_lus_send_quotes_to_slipstream_V25:::noexperiment&fps_mbmd_V11:::b&fps_quoteretrieval_aws_V115:::aws&fps_route_summary_traffic_shift_V6:::b&fss_Thor_TrafficTest_V30:::b&glu_springCleanRollout_V2:::a&rts_magpie_soow_data_collection_V5:::budget&rts_wta_shadowtraffic_V367:::b&scaffold_wireup_dont_delete_V1:::b; abgroup=72986736; ssculture=locale:::ru-RU&market:::RU&currency:::RUB; ASP.NET_SessionId=9lo12bkkv; firstvisit=overlay:::show; preferences=3d368559a26f40b287e8fbf82ba038de; ver=28; settings=acql:::true; acq=b0536e32-4d85-414f-b310-7a1c3ec3dd64|b0536e32-4d85-414f-b310-7a1c3ec3dd64; _ga=GA1.2.2035660979.1529763780; _gid=GA1.2.1175734101.1529763780; __gads=ID=2d38246fa1e732a7:T=1529763791:S=ALNI_MZH2nPIfHx0cDHM6qjUNxIqK40jJA; cto_lwid=aeb7d9d6-f965-4859-bfdf-a0c334b1a1c0; _ym_uid=1529763786475681610; _ym_d=1529763786; _pxvid=f811b9e0-76f0-11e8-908c-c9492bd5a489; usbls=1; _ym_isad=2; X-Mapping-rrsqbjcb=xsfzfc7gj3fhyzj1idgotbviqx2wmz9j; sspref=authcheckedexpiry:::1529766002921; _pxff_tm=1; akaas_skippy_aws_migration=1532357861~rv=39~id=bc17e00d6c7674fdf6b36b9cf5d0e6c2; akaas_flights_day_view=1532357871~rv=31~id=dd0ba16768c01464860e200fe27e7678; scanner=currency:::RUB&adultsV2:::1&childrenV2&from:::MOSC&to:::LED&fromCy:::RU&toCy:::RU&legs:::MOSC|2018-09-09|LED&oym:::1809&oday:::09&wy:::0&tripType:::one-way&cabinclass:::Economy&preferDirects; mp_2434748954c30ccc5017faa456fa3d38_mixpanel=%7B%22distinct_id%22%3A%20%221642d06d5ef63c-09d427d092baf9-5b183a13-1fa400-1642d06d5f0901%22%2C%22%24initial_referrer%22%3A%20%22%24direct%22%2C%22%24initial_referring_domain%22%3A%20%22%24direct%22%2C%22User%20Locale%22%3A%20%22RU-RU%22%2C%22User%20Market%22%3A%20%22RU%22%2C%22User%20Currency%22%3A%20%22RUB%22%2C%22New%20User%22%3A%20false%2C%22Internal%20User%22%3A%20%22%22%2C%22Mobile%22%3A%20%22FALSE%22%2C%22Tablet%22%3A%20%22FALSE%22%2C%22OS%20Version%22%3A%20%22NT%206.1%22%2C%22Device%20Model%22%3A%20%22CHROME%20-%20WINDOWS%22%2C%22Browser%20Version%22%3A%20%2267.0.3396.87%22%2C%22Microsite%22%3A%20%22SOL%22%2C%22Cookie%20Policy%20Alert%20Acknowledged%22%3A%20false%7D; RT="sl=1&ss=1529765820711&tt=1462&obo=0&bcn=%2F%2F36e4f0e6.akstat.io%2F&sh=1529765862288%3D1%3A0%3A1462&dm=skyscanner.ru&si=835bea88-7147-457a-b328-043a8cc56aeb"; _px3=c7016f23b372aea9a23bcf37330210035925c67ec8faeff550d0585253695d80:EwmN2LX0uPdfobVRxiO8/jc3l+hR/KC22gBYRyJ40iSOPjxvfvMpfhTXyZwFvgFXS/qfOMAWQ97ykNkqoWsdrg==:1000:wVGeYsy4mcH2cdEiUNTm7wy3wOcPBqTzj2ec8QMN0xa5uZfrkSl4Xn2zTUphkwatzFpKecW+WMImvaAzL8h6crWQvHBPOt4eJQG0U8F4aC1tMMonlihdGWjFUBak+iEaJx9vTbTiIIQ5pMnD740fvedDAkHfkGI0tH25fygOL5A=',
# 'referer': 'https://www.skyscanner.ru/transport/flights/mosc/led/180909/?adults=1&children=0&adultsv2=1&childrenv2=&infants=0&cabinclass=economy&rtn=0&preferdirects=false&outboundaltsenabled=false&inboundaltsenabled=false&ref=home',
# 'skyscanner-utid': '52ca03c6-63a2-4d51-a625-a73cb2a082e9',
# 'user-agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.87 Safari/537.36',
# 'x-distil-ajax': 'azezcavtdrrxfqrtbw',
# 'x-requested-with': 'XMLHttpRequest',
# 'x-skyscanner-devicedetection-ismobile': 'false',
# 'x-skyscanner-devicedetection-istablet': 'false',
# 'x-skyscanner-if-none-match': '14d77738-3454-405b-97a6-510835d65d7e',
# 'x-skyscanner-mixpanelid': '1642d06d5ef63c-09d427d092baf9-5b183a13-1fa400-1642d06d5f0901',
# 'x-skyscanner-traveller-context': '52ca03c6-63a2-4d51-a625-a73cb2a082e9',
# 'x-skyscanner-viewid': '11648349-d779-4dd6-92d0-b20b2085bb17'
}
response = requests.get('https://www.skyscanner.ru/g/conductor/v1/fps3/search/1cd19809-a1c7-4f87-94cb-358b15520175?geo_schema=skyscanner&carrier_schema=skyscanner&response_include=query%3Bdeeplink%3Bsegment%3Bstats%3Bfqs%3Bpqs%3B_flights_availability&force_fps=aws&_=1529877736386',
             headers=headers)
print(response)
data = response.json()
with open('conductor', 'w') as f:
    f.write(json.dumps(data, indent=2))
tickets = aviasales.parse(data)
print(len(tickets))
